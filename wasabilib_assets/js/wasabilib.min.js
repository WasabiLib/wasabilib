function DataExtractor(){var e=this;e.element=null}function Callback(e,t){var a=this;a.key=e,a.dataExtractor=t,a.condition=new Condition(function(){return!0})}function Condition(e){var t=this;t.handle=e,t.timeOut=0,t.actualTimerId=null}function Recipient(){var e=this;e.execRPCManager=null}function Alert(){Recipient.call(this);var e=this;e.ACTION_TYPE_JS_ALERT="alert"}function ConsoleLog(){Recipient.call(this)}function InnerHtml(){Recipient.call(this);var e=this;e.ACTION_TYPE_REPLACE="html",e.ACTION_TYPE_APPEND="appendTo",e.ACTION_TYPE_REMOVE="empty"}function DomManipulator(){Recipient.call(this)}function TriggerEventManager(){Recipient.call(this);var e=this;e.possibleEvents={ACTION_TYPE_TRIGGER_EVENT_NEXT_STEP:"nextStep",ACTION_TYPE_TRIGGER_EVENT_PREVIOUS_STEP:"prevStep",ACTION_TYPE_TRIGGER_EVENT_CLICK:"click",ACTION_TYPE_TRIGGER_EVENT_FOCUS:"focus"}}function Gritter(){Recipient.call(this)}function DropzoneManager(){Recipient.call(this);var e=this;e.possibleEvents={ACTION_TYPE_DROPZONE_DISCOVER:"discover"}}function ModalWindow(){Recipient.call(this)}function Suggest(){Recipient.call(this)}function Form(){DataExtractor.call(this)}function External_Form(){Form.call(this)}function Text_Field(){DataExtractor.call(this)}function WebSiteManager(){var e=this;e.wasabiNotificationCenter=new WasabiNotificationCenter(e),e.executeRemoteProcedureCallManager=null,e.registeredElements={},e.possibleEvents=null,e.possibleCallbacks={},e.registerCommonEvents()}function WasabiNotificationCenter(e){var t=this;t.websiteManager=e,t.observers=new Array}function ExecuteRemoteProcedureCallManager(){var e=this;e.possibleMethods=void 0,e.keywords={location:$(location)}}DataExtractor.prototype.setTarget=function(e){var t=this;t.element="object"==typeof e?e.closest(".ajax_element"):$("#"+e.closest(".ajax_element"))},DataExtractor.prototype.getTransmissionCapableContent=function(){var e=this;return e.element.attr("data-json")?JSON.parse(e.element.attr("data-json")):null},DataExtractor.prototype.getUri=function(){var e=this;return e.element.attr("href")?e.element.attr("href"):e.element.attr("data-href")?e.element.attr("data-href"):null},DataExtractor.prototype.getElement=function(){var e=this;return e.element},Callback.prototype.getKey=function(){var e=this;return e.key},Callback.prototype.execute=function(e){var t=this;t.dataExtractor.setTarget($(e.target))},Callback.prototype.setCondition=function(e){var t=this;t.condition=e},Callback.prototype.getCondition=function(){var e=this;return e.condition},Condition.prototype.check=function(e){var t=this;return t.handle(e)},Condition.prototype.checkTimeOut=function(e){var t=this;t.actualTimerId&&clearTimeout(t.actualTimerId),t.actualTimerId=setTimeout(function(){e(),t.actualTimerId=null},t.getTimeout())},Condition.prototype.setTimeout=function(e){var t=this;t.timeOut=e},Condition.prototype.getTimeout=function(){var e=this;return e.timeOut},Recipient.prototype.setExecuteRemoteProcedureCallManager=function(e){var t=this;t.execRPCManager=e},Recipient.prototype.update=function(e){var t=this,a=e.message;t.execRPCManager.execute(a.selector,a.actionType,a.params)},Alert.prototype=Object.create(Recipient.prototype),Alert.prototype.update=function(e){var t=this,a=e.message;t.execRPCManager.execute(void 0,a.actionType,a.params)},ConsoleLog.prototype=Object.create(Recipient.prototype),ConsoleLog.prototype.update=function(e){console.log(e.message)},InnerHtml.prototype=Object.create(Recipient.prototype),DomManipulator.prototype=Object.create(Recipient.prototype),TriggerEventManager.prototype=Object.create(Recipient.prototype),TriggerEventManager.prototype.update=function(e){var t=this,a=e.message;t.possibleEvents[a.params[0]]?t.execRPCManager.execute(a.selector,a.actionType,[t.possibleEvents[a.params[0]]]):console.log("The given event "+a.params[0]+" is not a valid event name")},Gritter.prototype=Object.create(Recipient.prototype),Gritter.prototype.update=function(e){var t=e.message;t.params.position&&($("#gritter-notice-wrapper").attr("class",""),jQuery.gritter.options.position=t.params.position),jQuery.gritter.add.apply($,[t.params])},DropzoneManager.prototype=Object.create(Recipient.prototype),DropzoneManager.prototype.update=function(e){var t=this,a=e.message;if("ajax_new_element"===e.recipientType){if(void 0!=window.Dropzone)try{t.execRPCManager.execute("dropzone","ACTION_TYPE_DROPZONE_DISCOVER",[])}catch(o){}}else t.possibleEvents[a.params[0]]?t.execRPCManager.execute(a.selector,a.actionType,[t.possibleEvents[a.params[0]]]):console.log("The given event "+a.params[0]+" is not a valid event name")},ModalWindow.prototype=Object.create(Recipient.prototype),ModalWindow.prototype.update=function(e){var t=this,a=e.message;$(".modal").size()>1&&$(a.selector).attr("data-backdrop","false"),setTimeout(function(){t.execRPCManager.execute(a.selector,a.actionType,a.params)},200)},Suggest.prototype=Object.create(Recipient.prototype),Suggest.prototype.update=function(e){var t=$(e.message.selector),a=t.attr("id")+"-result",o=e.message.params.size,r=e.message.params.list;null==o&&(o=t.outerWidth()),$("#"+a).remove(),$("<div id='"+a+"' class='wasabi-suggest-result-container list-group'  style='display: block; width:"+o+"px'>"+r+"</div>").insertAfter(t);var n=t.val().length,i=t.val().substr(0,n),s="";$("#"+a).find("a h4").each(function(){s=$(this).html(),$(this).html(""),s=s.replace("<span id='"+a+"_bold' class='suggest_result_bold'>",""),s=s.replace("</span>","");var e=s.toLowerCase().indexOf(i.toLowerCase()),t=s.substr(e,i.length);$(this).html(s.replace(t,"<span id='"+a+"_bold' class='suggest_result_bold'>"+t+"</span>"))})},Form.prototype=Object.create(DataExtractor.prototype),Form.prototype.setTarget=function(e){var t=this;t.element="object"==typeof e?e:$("#"+e)},Form.prototype.getTransmissionCapableContent=function(){var e=this;return e.getElement().serializeArray()},Form.prototype.getUri=function(){var e=this;return e.getElement().attr("action")},External_Form.prototype=Object.create(Form.prototype),External_Form.prototype.setTarget=function(e){var t=this;t.element="FORM"===e.tagName?e:$("#"+e.attr("form")),t.jsonParams=$(e).attr("data-json")?JSON.parse("["+$(e).attr("data-json")+"]"):null},External_Form.prototype.getTransmissionCapableContent=function(){var e=this,t=Form.prototype.getTransmissionCapableContent.call(this);return e.jsonParams&&$.merge(t,e.jsonParams),t},Text_Field.prototype=Object.create(DataExtractor.prototype),Text_Field.prototype.getTransmissionCapableContent=function(){var e=this;return{content:e.getElement().val()}},WebSiteManager.prototype.getWasabiNotificationCenter=function(){var e=this;return e.wasabiNotificationCenter},WebSiteManager.prototype.setWasabiNotificationCenter=function(e){var t=this;t.wasabiNotificationCenter=e},WebSiteManager.prototype.setExecuteRemoteProcedureCallManager=function(e){var t=this;t.executeRemoteProcedureCallManager=e},WebSiteManager.prototype.getExecuteRemoteProcedureCallManager=function(){var e=this;return e.executeRemoteProcedureCallManager},WebSiteManager.prototype.addCallback=function(e){var t=this;t.possibleCallbacks[e.getKey()]=e,t.registerEventHandler()},WebSiteManager.prototype.registerCommonEvents=function(){var e=this;$(document).on("wasabiNotification",null,function(t){e.getWasabiNotificationCenter().notify(t.message)}),$(document).on("hidden.bs.modal",document,function(e){setTimeout(function(){$("#"+e.target.id).remove()},301)}),$(document).on("show.bs.modal",".modal",function(){var e=$(".modal").size();if(e>1){var t=e+parseInt($(this).css("zIndex"));$(this).css("zIndex",t),$(".modal-backdrop.in:last").css("zIndex",t-1)}}).on("hide.bs.modal",".modal",function(){var e=new Array;$(".modal").each(function(){e.push($(this).css("zIndex"))}),e.sort(),$(".modal-backdrop.in:last").css("zIndex",e[e.length-2]-1)})},WebSiteManager.prototype.registerEventHandler=function(){var e=this;$(".ajax_element").each(function(){var t=$(this).attr("data-event"),a=$(this).attr("id"),o=$("#"+a),r=e.getCallback(o.attr("data-cb"));e.registeredElements[a]||void 0!=o.attr("data-cb")&&void 0==r||("FORM"===o.prop("tagName")?(t=t?t:"submit",r=r?r:e.getCallback("form")):"A"===o.prop("tagName")?(r=r?r:e.getCallback("link"),t=t?t:"click"):o.hasClass("wasabi_suggest")?(r=r?r:e.getCallback("suggest"),t=t?t:"keyup"):(r=r?r:e.getCallback("button"),t=t?t:"click"),t&&r&&(e.possibleEvents[t]&&$(this).attr("id")&&$(document).on(t,"#"+a,function(t){t.preventDefault(),r.execute(t);var a={};if("FORM"===r.dataExtractor.getElement().prop("tagName")&&"get"!=r.dataExtractor.getElement().attr("method")&&(a.type="POST"),r.getCondition().check(t)){var o=r.dataExtractor.getElement().attr("data-timeout");void 0!=o?r.getCondition().setTimeout(o):null;var n=r.dataExtractor.getElement().attr("data-disabletime");if(n&&("A"===r.dataExtractor.getElement().prop("tagName")&&r.dataExtractor.getElement().attr("data-href",r.dataExtractor.getElement().attr("href")).removeAttr("href"),"FORM"===r.dataExtractor.getElement().prop("tagName")?r.dataExtractor.getElement().find("[type=submit]").prop("disabled",!0):r.dataExtractor.getElement().prop("disabled",!0),"true"!==n&&$.isNumeric(n))){var i=new Condition;i.setTimeout(n),i.checkTimeOut(function(){"A"===r.dataExtractor.getElement().prop("tagName")&&r.dataExtractor.getElement().attr("href",r.dataExtractor.getElement().attr("data-href")).removeAttr("data-href"),"FORM"===r.dataExtractor.getElement().prop("tagName")?r.dataExtractor.getElement().find("[type=submit]").prop("disabled",!1):r.dataExtractor.getElement().prop("disabled",!1)})}r.getCondition().checkTimeOut(function(){e.wasabiNotificationCenter.send(r.dataExtractor.getUri(),r.dataExtractor,a)})}}),e.registeredElements[a]=!0))})},WebSiteManager.prototype.getCallback=function(e){var t=this;return!e||t.possibleCallbacks[e]?e?t.possibleCallbacks[e]:null:void 0},WebSiteManager.prototype.setPossibleEvents=function(e){var t=this;t.possibleEvents=e},WebSiteManager.prototype.addPossibleEvent=function(e){var t=this;t.possibleEvents[e]=!0},WasabiNotificationCenter.prototype.register=function(e){var t=this;e.setExecuteRemoteProcedureCallManager(t.websiteManager.getExecuteRemoteProcedureCallManager()),t.observers.push(e)},WasabiNotificationCenter.prototype.remove=function(e,t){var a=this;delete a.observers[a.generateIndex(e,t)]},WasabiNotificationCenter.prototype.generateIndex=function(e,t){return e+"+"+t},WasabiNotificationCenter.prototype.notify=function(e){var t=this;jQuery.each(t.observers,function(t){var t=this;jQuery.each(e,function(e,a){void 0!=window[a.recipientType]&&t instanceof window[a.recipientType]&&t.update(a)})})},WasabiNotificationCenter.prototype.send=function(e,t,a){var o=this,r="GET",n="json";a&&(a.type?r=a.type:!1);var i=t?t.getTransmissionCapableContent():{},s=t.getElement().attr("data-json")?JSON.parse(t.getElement().attr("data-json")):{},l=i;s&&($.isArray(i)?$.each(s,function(e,t){i.push({name:e,value:t})}):$.extend(l,i,s)),l=$.extend(l,{triggeredId:t.getElement().attr("id")}),$.ajax({type:r,url:e,data:l,dataType:n,beforeSend:function(){t.getElement().attr("data-ajax-loader")?$("#"+t.getElement().attr("data-ajax-loader")).show():null}}).done(function(e){e.push({recipientType:"ajax_new_element",status:200}),o.notify(e),o.websiteManager.registerEventHandler(),t.getElement().attr("data-ajax-loader")?$("#"+t.getElement().attr("data-ajax-loader")).hide():null,void 0!=t.getElement().attr("data-disabletime")&&"true"==t.getElement().attr("data-disabletime")&&("A"===t.getElement().prop("tagName")&&t.getElement().attr("href",t.getElement().attr("data-href")).removeAttr("data-href"),"FORM"===t.getElement().prop("tagName")?t.getElement().find("[type=submit]").prop("disabled",!1):t.getElement().prop("disabled",!1))})},ExecuteRemoteProcedureCallManager.prototype.execute=function(e,t,a){var o=this;o.possibleMethods[t]?o.keywords[e]?o.keywords[e][o.possibleMethods[t]].apply(o.keywords[e],a):void 0==e?window[o.possibleMethods[t]].apply(window,a):$(e)[o.possibleMethods[t]].apply($(e),a):console.log("The given method "+t+" is not a valid method name")},ExecuteRemoteProcedureCallManager.prototype.setPossibleMethods=function(e){var t=this;t.possibleMethods=e},$.fn.extend({getWebsiteManager:function(){return null}}),$(document).ready(function(){var e=new WebSiteManager;$.fn.getWebsiteManager=function(){return e},e.setPossibleEvents({select:!0,search:!0,dblclick:!0,mouseover:!0,mouseout:!0,click:!0,mousedown:!0,submit:!0,blur:!0,keyup:!0,keydown:!0,keypress:!0}),e.setExecuteRemoteProcedureCallManager(new ExecuteRemoteProcedureCallManager),e.getWasabiNotificationCenter().register(new Alert),e.getWasabiNotificationCenter().register(new InnerHtml),e.getWasabiNotificationCenter().register(new DomManipulator),e.getWasabiNotificationCenter().register(new ModalWindow),e.getWasabiNotificationCenter().register(new ConsoleLog),e.getWasabiNotificationCenter().register(new Gritter),e.getWasabiNotificationCenter().register(new TriggerEventManager),e.getWasabiNotificationCenter().register(new Suggest),e.addCallback(new Callback("link",new DataExtractor)),e.addCallback(new Callback("button",new DataExtractor)),e.addCallback(new Callback("ext_form_submit",new External_Form)),e.addCallback(new Callback("form",new Form)),e.addCallback(new Callback("text",new Text_Field));var t=new Callback("suggest",new Text_Field),a=new Condition(function(e){var a=t,o=a.dataExtractor.getElement().attr("data-digits");return o<=a.dataExtractor.getTransmissionCapableContent().content.length&&(e.which>40||e.which<37)});a.setTimeout(300),t.setCondition(a),e.addCallback(t),e.getExecuteRemoteProcedureCallManager().setPossibleMethods({ACTION_TYPE_SHOW:"show",ACTION_TYPE_HIDE:"hide",ACTION_TYPE_MODAL:"modal",ACTION_TYPE_SLIDEDOWN:"slideDown",ACTION_TYPE_SLIDEUP:"slideUp",ACTION_TYPE_REPLACE:"html",ACTION_TYPE_APPEND:"append",ACTION_TYPE_REMOVE:"empty",ACTION_TYPE_CSS:"css",ACTION_TYPE_FADEOUT:"fadeOut",ACTION_TYPE_FADEIN:"fadeIn",ACTION_TYPE_ATTR:"attr",ACTION_TYPE_ADD_CLASS:"addClass",ACTION_TYPE_REMOVE_CLASS:"removeClass",ACTION_TYPE_TOGGLE_CLASS:"toggleClass",ACTION_TYPE_HREF:"href",ACTION_TYPE_DROPZONE_DISCOVER:"discover",ACTION_TYPE_TRIGGER:"trigger",ACTION_TYPE_REMOVE_ELEMENT:"remove",ACTION_TYPE_JS_ALERT:"alert"});new WasabiSuggestFeatures});
